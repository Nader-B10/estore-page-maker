# توثيق تقني: أداة بناء المتاجر الإلكترونية الثابتة

## 1. نظرة عامة

هذا المشروع هو تطبيق ويب تفاعلي (SPA) مبني باستخدام React و TypeScript. يتيح للمستخدمين بناء وتخصيص صفحة متجر إلكتروني بشكل مرئي، ومن ثم تصديرها كملفات HTML, CSS, و JS ثابتة ومستقلة تمامًا (لا تتطلب أي مكتبات خارجية أو اتصال بالإنترنت للعمل).

الهدف الأساسي هو تمكين المستخدمين من إنشاء متاجر إلكترونية بسيطة وجذابة بسرعة، دون الحاجة إلى معرفة برمجية، مع توفير مخرجات عالية الأداء وقابلة للنشر على أي خدمة استضافة للمواقع الثابتة.

---

## 2. الهيكلية المعمارية (Architecture)

يعتمد التطبيق على فصل واضح للمسؤوليات بين أربعة مكونات أساسية:

1.  **واجهة المستخدم الخاصة بالبنّاء (Builder UI):** هي الواجهة التفاعلية التي يستخدمها المستخدم للتعديل. مبنية بالكامل باستخدام React ومكونات `lucide-react` للأيقونات.
2.  **إدارة الحالة المركزية (State Management):** يتم استخدام React Context API (`StoreContext`) كـ "مصدر الحقيقة الأوحد" (Single Source of Truth) لجميع بيانات المتجر (الإعدادات، المنتجات، محتوى الأقسام). هذا يضمن أن أي تغيير في البيانات ينعكس فورًا في جميع أنحاء واجهة المستخدم والمعاينة المباشرة.
3.  **نظام القوالب (Templating System):** نظام مرن يسمح بفصل منطق العرض داخل البنّاء عن منطق توليد الكود النهائي. لكل قسم من أقسام الموقع (مثل قسم البطل، المنتجات، الأسئلة الشائعة)، يوجد قالب مخصص.
4.  **محرك التصدير (Export Engine):** مجموعة من الأدوات والمولدات المسؤولة عن تحويل بيانات المتجر من صيغة JSON (الموجودة في الحالة) إلى ملفات موقع ثابتة (`index.html`, `styles.css`, `main.js`, ومجلد للصور).

---

## 3. تدفق البيانات (Data Flow)

-   **`StoreContext.tsx`**: هو قلب إدارة الحالة. يقوم بتوفير `storeData` (الذي يحتوي على `settings` و `products`) ومجموعة من الدوال لتحديث هذه الحالة (`updateSettings`, `addProduct`, `editProduct`, إلخ) لجميع المكونات الفرعية.
-   **المكونات التفاعلية**: مكونات مثل `GeneralSettings.tsx` أو `ProductForm.tsx` تستدعي دوال التحديث من الـ Context عند تفاعل المستخدم (مثل تغيير اسم المتجر أو إضافة منتج جديد).
-   **انعكاس التغييرات**: بمجرد تحديث الحالة في `StoreContext`، تقوم React بإعادة رسم جميع المكونات التي تستهلك هذه الحالة.
-   **`StorePreview.tsx`**: هذا المكون يستهلك `storeData` بشكل مباشر ويعرض معاينة حية ودقيقة للمتجر النهائي باستخدام مكونات React خاصة بالمعاينة (`Preview.tsx` من كل قالب). هذا يمنح المستخدم رؤية فورية لتأثير تعديلاته.

---

## 4. نظام القوالب والإنشاء (Templating & Generation)

هذا هو الجزء الأكثر تعقيدًا وأهمية في المشروع. يقع في مجلد `/src/templates`.

### 4.1. بنية القالب

كل قسم قابل للتخصيص في المتجر (مثل `hero`, `products`, `faq`) له مجلد قالب خاص به. كل مجلد يحتوي على:

-   **`Preview.tsx`**: مكون React وظيفي يعرض معاينة حية للقسم داخل البنّاء. يستقبل `storeData` ويعرض القسم بناءً عليها باستخدام JSX و CSS Modules/Tailwind.
-   **`generator.ts`**: دالة TypeScript بسيطة. وظيفتها هي أخذ نفس `storeData` وتوليد سلسلة نصية (string) تحتوي على كود HTML النقي الخاص بذلك القسم. هذا الكود هو ما سيتم كتابته في ملف `index.html` النهائي.
-   **`metadata.ts`**: ملف يحتوي على بيانات وصفية عن القالب.
-   **`index.ts`**: ملف يقوم بتصدير كل ما سبق لتسهيل الاستيراد.

### 4.2. سجل القوالب (Template Registry)

-   **`src/templates/registry.ts`**: هذا الملف يعمل كخريطة مركزية. يقوم باستيراد جميع وحدات القوالب وربط كل مفتاح قسم (مثل `featuredProducts`) بالقالب الافتراضي الخاص به.
-   هذا السجل يسمح لكل من `StorePreview` (للمعاينة) و `htmlGenerator` (للتصدير) بالعثور ديناميكيًا على المكون أو الدالة الصحيحة لكل قسم.

### 4.3. مولدات الكود (Code Generators)

تقع في `/src/utils/generators`. هذه الوحدات هي المسؤولة عن إنشاء محتوى الملفات النهائية.

-   **`htmlGenerator.ts`**: يستدعي دوال `generator` من القوالب المناسبة بالترتيب الصحيح ويجمع مخرجاتها داخل هيكل HTML أساسي.
-   **`staticCss.ts`**: يقوم بإنشاء ملف CSS ثابت يحتوي على جميع تنسيقات Tailwind المستخدمة في القوالب، مع استخدام متغيرات CSS (CSS Variables) للقيم الديناميكية مثل الألوان والخطوط. هذا يلغي الحاجة إلى تضمين مكتبة Tailwind بأكملها في الموقع المُصدَّر، مما يجعله سريعًا وخفيفًا.
-   **`jsGenerator.ts`**: ينشئ ملف JavaScript بسيط للوظائف التفاعلية الأساسية في الموقع النهائي، مثل أكورديون الأسئلة الشائعة.
-   **`iconGenerator.ts`**: يقوم بتضمين كود SVG للأيقونات مباشرة في HTML، مما يقلل من عدد طلبات الشبكة (HTTP requests) في الموقع النهائي.

---

## 5. عملية التصدير (Export Process)

يتم تنسيق عملية التصدير بواسطة **`src/utils/fileExporter.ts`**.

1.  **الاستدعاء**: تبدأ العملية عند النقر على زر "تحميل المتجر"، الذي يستدعي دالة `exportStore`.
2.  **معالجة الصور**:
    -   يتم إنشاء نسخة عميقة من `storeData` لتجنب تعديل الحالة الأصلية.
    -   يتم المرور على جميع الصور المرفوعة من قبل المستخدم (المنتجات، الشعار، إلخ) والتي تكون بصيغة `base64 data URL`.
    -   يتم تحويل كل صورة `base64` إلى `Blob` (كائن ثنائي).
    -   تُضاف هذه الـ `Blob` إلى مجلد `images/` داخل كائن `JSZip`.
    -   يتم تحديث مسار الصورة في `storeData` المنسوخ ليشير إلى المسار النسبي الجديد (مثل `images/product-123.png`).
3.  **توليد الملفات**:
    -   يتم استدعاء `generateStoreHTML`, `generateStaticCss`, و `generateStoreJS` مع `storeData` المُعدَّل لتوليد محتوى الملفات.
    -   تُضاف هذه الملفات إلى جذر كائن `JSZip`.
4.  **الضغط والتحميل**:
    -   تُستخدم مكتبة `JSZip` لضغط جميع الملفات التي تمت إضافتها في ملف `.zip` واحد في الذاكرة.
    -   تُستخدم مكتبة `file-saver` لتحفيز عملية تحميل ملف الـ `.zip` في متصفح المستخدم.

---

## 6. شرح هيكل الملفات والمجلدات الرئيسية

-   **`/src`**: المجلد الرئيسي للتطبيق.
    -   **`/components`**: يحتوي على جميع مكونات React UI.
        -   **`/StoreBuilder`**: المكونات الرئيسية التي تشكل لوحة التحكم (مثل `ProductManager`, `SectionsManager`).
        -   **`/SettingsPanel`**: مكونات خاصة بصفحة الإعدادات (مثل `GeneralSettings`, `ThemeSettings`).
        -   **`/SectionsManager`**: مكونات تحرير محتوى الأقسام (مثل `HeroSectionEditor`, `FAQEditor`).
        -   **`/ProductManager`**: مكونات إدارة المنتجات (بطاقة المنتج، نموذج الإضافة/التعديل).
        -   **`/StorePreview`**: مكونات خاصة بالمعاينة المباشرة داخل البنّاء.
        -   **`/layout`**: مكونات التخطيط العام للتطبيق مثل الهيدر والـ `MainLayout`.
    -   **`/contexts`**: يحتوي على `StoreContext.tsx` لإدارة الحالة.
    -   **`/templates`**: نظام القوالب الديناميكي (مشروح أعلاه).
    -   **`/themes`**: يحتوي على `palettes.ts` الذي يعرف مصفوفة من الثيمات اللونية المتاحة.
    -   **`/types`**: يحتوي على `store.ts` الذي يعرف جميع واجهات TypeScript (`interfaces`) المستخدمة في المشروع لضمان سلامة الأنواع (Type Safety).
    -   **`/utils`**: يحتوي على الأدوات المساعدة والمنطق الخاص بالتصدير.
        -   **`/generators`**: مولدات الكود للمخرجات النهائية.
        -   **`fileExporter.ts`**: المنسق لعملية التصدير.
        -   **`storeGenerator.ts`**: نقطة تجميع لمولدات الكود.
    -   **`App.tsx`**: المكون الجذري للتطبيق.
    -   **`main.tsx`**: نقطة الدخول الرئيسية للتطبيق، حيث يتم ربط React بالـ DOM.
